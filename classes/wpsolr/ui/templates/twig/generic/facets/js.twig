<script>

    var WPSOLR_Facets = function () {
        console.log("Facets constructor");

        this.facets = {};
        this.facets.field = [];
        this.facets.range = [];
        this.url = "";
    };

    WPSOLR_Facets.prototype.debug = function (message, object) {
        console.log("=> " + message + ": " + JSON.stringify(object));
    };

    WPSOLR_Facets.prototype.debugState = function () {
        console.log("++ facets: " + JSON.stringify(this.facets));
        console.log("++ url: " + JSON.stringify(this.url));
    };

    WPSOLR_Facets.prototype.addFacetValue = function (facet) {
        this.debug("add facet", facet);
        this.debugState();

        this.facets.field.push(facet);

        this.debugState();
    };

    WPSOLR_Facets.prototype.addFacetRangeValue = function (facet) {
        this.debug("add facet range", facet);
        this.debugState();

        this.facets.range.push(facet);

        this.debugState();
    };

    WPSOLR_Facets.prototype.create_url = function () {
        this.debug("url");
        this.debugState();

        var url1 = new Url(window.location.href);

        // query
        url1.query['s'] = '';


        // Add field parameters
        var facets = this.facets.field || [];
        for (i = 0; i < facets.length; i++) {
            url1.query['wpsolr_fq' + '[' + i + ']'] = facets[i].facet_id + ":" + facets[i].facet_value;
        }

        // Add range parameters
        var facets = this.facets.range || [];
        for (i = 0; i < facets.length; i++) {
            url1.query['wpsolr_fq' + '[' + i + ']'] = facets[i].facet_id + ":" + "[" + facets[i].facet_value + " TO " + (facets[i].range_sup) + "]";
        }


        this.url = url1.toString();

        window.location.href = this.url;

        this.debugState();
    };


    // Global object used by one widget
    var wpsolr_facets = new WPSOLR_Facets();

</script>